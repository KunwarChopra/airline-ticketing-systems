DROP PROCEDURE DROP_TABLE;
create or replace PROCEDURE DROP_TABLE(ENTNAME varchar2,ENTTYPE varchar2) IS
nCount NUMBER;
BEGIN
if ENTTYPE = 'TABLE' THEN
SELECT count(*) into nCount FROM user_tables where table_name = upper(ENTNAME);
IF (nCount > 0) THEN
EXECUTE IMMEDIATE 'drop table ' || ENTNAME || ' cascade constraints';
END IF;
END IF;
if ENTTYPE = 'PROCEDURE' THEN
select count(*) into nCount from user_objects where object_type = 'PROCEDURE' and object_name = upper(ENTNAME);
if nCount > 0 then
execute immediate 'DROP PROCEDURE ' || ENTNAME;
end if;
end if;
if ENTTYPE = 'TRIGGER' then
select count(*) into nCount from user_triggers where trigger_name = upper(ENTNAME);
if nCount > 0 then
execute immediate 'DROP TRIGGER ' || ENTNAME;
end if;
end if;
if ENTTYPE = 'SEQUENCE' then
select count(*) into nCount from user_sequences where sequence_name = upper(ENTNAME);
if nCount > 0 then
execute immediate 'DROP SEQUENCE ' || ENTNAME;
end if;
end if;
END;
/
--DROP ALL TABLES
CALL DROP_TABLE('LOGIN_SIGNUP','TABLE');
CALL DROP_TABLE('MEMBERSHIP','TABLE');
CALL DROP_TABLE('PASSENGERS','TABLE');
CALL DROP_TABLE('ITINERARY_RESERVATION','TABLE');
CALL DROP_TABLE('PAYMENT','TABLE');
CALL DROP_TABLE('AIRPORTS','TABLE');
CALL DROP_TABLE('FLIGHT_SEGMENT','TABLE');
CALL DROP_TABLE('LEGS','TABLE');
CALL DROP_TABLE('ITINERARY_LEGS','TABLE');
CALL DROP_TABLE('FLIGHT_STATUS','TABLE');
CALL DROP_TABLE('FLIGHT_COST','TABLE');
CALL DROP_TABLE('REFERENCE_CALENDER','TABLE');
CALL DROP_TABLE('BOARDING_PASS','TABLE');


-------- CREATE TABLES AND INSERT DATA INTO TABLE -----------
CREATE TABLE LOGIN_SIGNUP
(
PHONE_NUMBER NUMBER(10) NOT NULL,
AGENT_ID NUMBER(10) NOT NULL,
FIRST_NAME VARCHAR2(30) NOT NULL,
LAST_NAME VARCHAR2(30) NOT NULL,
EMAIL_ID VARCHAR2(30) NOT NULL,
PASSWORD VARCHAR2(30) NOT NULL,
PRIMARY KEY(PHONE_NUMBER)
);
INSERT INTO LOGIN_SIGNUP VALUES(9823455609, 1234, 'SHASHANK', 'JAIN', 'JAIN.S@GMAIL.COM', '123456SJK@7890');
INSERT INTO LOGIN_SIGNUP VALUES(9824277756, 2532, 'KUNWAR', 'CHOPRA', 'KUNWAR.C@GMAIL.COM', '3531.76A865F');
INSERT INTO LOGIN_SIGNUP VALUES(6174549256, 9657, 'DIVYA', 'SHINDE', 'SHINDE.D@GMAIL.COM', '245af3579AB');
INSERT INTO LOGIN_SIGNUP VALUES(6176979835, 2524, 'ADITYA', 'SARGAR', 'SARGAR.A@GMAIL.COM', '097698BCHJa@SFG');
INSERT INTO LOGIN_SIGNUP VALUES(9890535662, 6426, 'Niul', 'Koshti', 'KOSHTI.NIUL@GMAIL.COM', '2421579695#FKHJGS');
INSERT INTO LOGIN_SIGNUP VALUES(6173598976, 9762, 'Saurabh', 'Tripathi', 'TRIPATHI,S@GMAIL.COM', '241512867@FHJKA');
INSERT INTO LOGIN_SIGNUP VALUES(8098536897, 3525, 'Apurva', 'Shewale', 'SHEWALE.A@GMAIL.COM', '245SGFDfGT24');
INSERT INTO LOGIN_SIGNUP VALUES(7686508045, 6426, 'Tejas', 'Bawankar', 'BAWANKAR.T@GMAIL.COM', 'SDGDJKH24255');
INSERT INTO LOGIN_SIGNUP VALUES(9876942143, 2563, 'Etha', 'Salunke', 'SALUNKE.E@GMAIL.COM', 'SG@355#HKJGHKU');
INSERT INTO LOGIN_SIGNUP VALUES(5154297964, 6245, 'Anjali', 'Patkar', 'PATKAR.A@GMAIL.COM', '35326@FAG#536');
INSERT INTO LOGIN_SIGNUP VALUES(6174358976, 6245, 'Shreya', 'Subedi', 'SUBEDI.S@GMAIL.COM', '976976RSGF3');
INSERT INTO LOGIN_SIGNUP VALUES(5179753976, 6426, 'Sheetal', 'Kumar', 'KUMAR.SH@GMAIL.COM', '62456SGAJ35@GG');
INSERT INTO LOGIN_SIGNUP VALUES(5315431975, 2455, 'Siddhart', 'Sawant', 'SAWANT.SIDDHART@GMAIL.COM', 'GSAH352@56$GS35');
INSERT INTO LOGIN_SIGNUP VALUES(5246279765, 5083, 'HERIKA', 'HARESH', 'HARESH.HERIKA@GMAIL.COM', '351ASbjkjh@3hkju#kj');
INSERT INTO LOGIN_SIGNUP VALUES(6325236235, 5325, 'GAURI', 'PASARKAR', 'PASARKAR.GAURI@GMAIL.COM', '3564231fdsdgaA@GG');
CREATE TABLE MEMBERSHIP
(
PHONE_NUMBER NUMBER(10) NOT NULL,
EMAIL_ID VARCHAR2(30) NOT NULL,
MEMBER_TYPE VARCHAR2(30) NOT NULL,
FREE_MILES VARCHAR2(30) NOT NULL,
FOREIGN KEY (PHONE_NUMBER) REFERENCES LOGIN_SIGNUP(PHONE_NUMBER)
);
INSERT INTO MEMBERSHIP VALUES (9823455609,'JAIN.S@GMAIL.COM','GOLD',5000);
INSERT INTO MEMBERSHIP VALUES (9824277756,'KUNWAR.C@GMAIL.COM','SILVER',3000);
INSERT INTO MEMBERSHIP VALUES (6174549256,'SHINDE.D@GMAIL.COM','GOLD',5000);
INSERT INTO MEMBERSHIP VALUES (6176979835,'SARGAR.A@GMAIL.COM','SILVER',3000);
INSERT INTO MEMBERSHIP VALUES (9890535662,'KOSHTI.NIUL@GMAIL.COM','SILVER',3000);
INSERT INTO MEMBERSHIP VALUES (6173598976,'TRIPATHI.S@GMAIL.COM','PLATINUM',7000);
INSERT INTO MEMBERSHIP VALUES (8098536897,'SHEWALE.A@GMAIL.COM','SILVER',3000);
INSERT INTO MEMBERSHIP VALUES (7686508045,'SALUNKE.E@GMAIL.COM','PLATINUM',7000);
INSERT INTO MEMBERSHIP VALUES (7686508045,'BAWANKAR.T@GMAIL.COM','GOLD',5000);
INSERT INTO MEMBERSHIP VALUES (9876942143,'SALUNKE.E@GMAIL.COM','PLATINUM',5000);
INSERT INTO MEMBERSHIP VALUES (5154297964,'PATKAR.A@GMAIL.COM','SILVER',3000);
INSERT INTO MEMBERSHIP VALUES (6174358976,'SUBEDI.S@GMAIL.COM','GOLD',5000);
INSERT INTO MEMBERSHIP VALUES (5179753976,'KUMAR.SH@GMAIL.COM','SILVER',3000);
INSERT INTO MEMBERSHIP VALUES (5315431975,'HARESH.HERIKA@GMAIL.COM','SILVER',3000);
INSERT INTO MEMBERSHIP VALUES (5246279765,'SAWANT.SIDDHART@GMAIL.COM','GOLD',5000);
INSERT INTO MEMBERSHIP VALUES (6325236235,'PASARKAR.GAURI@GMAIL.COM','SILVER',3000);
CREATE TABLE PASSENGERS
(
PASSENGER_ID VARCHAR2(10),
PHONE_NUMBER NUMBER(10) NOT NULL,
FIRST_NAME VARCHAR2(20) NOT NULL,
LAST_NAME VARCHAR2(20) NOT NULL,
EMAIL_ID VARCHAR2(30) NOT NULL,
CITY VARCHAR2(20) NOT NULL,
STATE VARCHAR2(20) NOT NULL,
COUNTRY VARCHAR2(20) NOT NULL,
PRIMARY KEY (PASSENGER_ID),
FOREIGN KEY (PHONE_NUMBER) REFERENCES LOGIN_SIGNUP(PHONE_NUMBER)
);
INSERT INTO PASSENGERS VALUES(001,9823455609,'SHASHANK', 'JAIN', 'JAIN.S@GMAIL.COM','BOSTON','MA','USA');
INSERT INTO PASSENGERS VALUES(987,9824277756,'Kunwar', 'Chopra', 'KUNWAR.C@GMAIL.COM','NEW YORK','NYC','USA');
INSERT INTO PASSENGERS VALUES(326,6174549256,'Divya', 'Shinde', 'SHINDE.D@GMAIL.COM','LONDON','EN','UK');
INSERT INTO PASSENGERS VALUES(421,6176979835,'Aditya', 'Sargar', 'SARGAR.A@GMAIL.COM','MUMBAI','MH','INDIA');
INSERT INTO PASSENGERS VALUES(555,9890535662,'Niul', 'Koshti', 'KOSHTI.NIUL@GMAIL.COM','SEATTLE','WH','USA');
INSERT INTO PASSENGERS VALUES(647,6173598976,'Saurabh', 'Tripathi', 'TRIPATHI.S@GMAIL.COM','TEMPA','AZ','USA');
INSERT INTO PASSENGERS VALUES(111,8098536897,'Apurva', 'Shewale', 'SHEWALE.A@GMAIL.COM','BOSTON','MA','USA');
INSERT INTO PASSENGERS VALUES(469,7686508045,'Tejas', 'Bawankar', 'BAWANKAR.T@GMAIL.COM','NEW YORK','NYC','USA' );
INSERT INTO PASSENGERS VALUES(980,9876942143,'Etha', 'Salunke', 'SALUNKE.E@GMAIL.COM','LONDON','EN','UK' );
INSERT INTO PASSENGERS VALUES(888,5154297964,'Anjali', 'Patkar', 'PATKAR.A@GMAIL.COM','SAN DIEGO','CL' ,'USA');
INSERT INTO PASSENGERS VALUES(611,6174358976, 'Shreya', 'Subedi', 'SUBEDI.S@GMAIL.COM','DETROIT','MG','USA');
INSERT INTO PASSENGERS VALUES(777,5179753976,'Sheetal', 'Kumar', 'KUMAR.SH@GMAIL.COM','NEW HAMPSHIRE','NW','USA');
INSERT INTO PASSENGERS VALUES(038,5246279765,'HERIKA', 'HARESH', 'HARESH.HERIKA@GMAIL.COM','BOSTON','MA','USA');
INSERT INTO PASSENGERS VALUES(820,5315431975,'Siddhart', 'Sawant', 'SAWANT.SIDDHART@GMAIL.COM','BOSTON','MA','USA');
INSERT INTO PASSENGERS VALUES(499,6325236235,'GAURI', 'PASARKAR', 'PASARKAR.GAURI@GMAIL.COM','BOSTON','MA','USA');
CREATE TABLE ITINERARY_RESERVATION
(
RESERVATION_ID VARCHAR2(10),
PASSENGER_ID VARCHAR2(10),
RESERVATION_STATUS_CODE VARCHAR2(10) NOT NULL,
TRAVEL_CLASS_CODE VARCHAR2(20) NOT NULL,
RESERVATION_DATE DATE NOT NULL,
CONSTRAINT PK_RESERVATION_ID PRIMARY KEY (RESERVATION_ID)
);
INSERT INTO ITINERARY_RESERVATION VALUES('J8712469','001','CONFIRMED','J',DATE'2022-02-16');
INSERT INTO ITINERARY_RESERVATION VALUES('K9728499','987','CANCELLED','W',DATE'2022-04-10');
INSERT INTO ITINERARY_RESERVATION VALUES('H3457215','326','CONFIRMED','Y',DATE'2022-03-15');
INSERT INTO ITINERARY_RESERVATION VALUES('O6582930','421','CANCELLED','Y',DATE'2022-06-16');
INSERT INTO ITINERARY_RESERVATION VALUES('A1634528','555','CONFIRMED','F',DATE'2022-02-10');
INSERT INTO ITINERARY_RESERVATION VALUES('L0849372','647','CONFIRMED','J',DATE'2022-05-07');
INSERT INTO ITINERARY_RESERVATION VALUES('C8739275','111','CANCELLED','W',DATE'2022-03-14');
INSERT INTO ITINERARY_RESERVATION VALUES('X5638952','980','CONFIRMED','Y',DATE'2022-04-04');
INSERT INTO ITINERARY_RESERVATION VALUES('F4452398','888','CONFIRMED','Y',DATE'2022-02-22');
INSERT INTO ITINERARY_RESERVATION VALUES('B3462597','611','CANCELLED','Y',DATE'2022-02-27');
INSERT INTO ITINERARY_RESERVATION VALUES('R5684329','777','CONFIRMED','F',DATE'2022-03-19');
INSERT INTO ITINERARY_RESERVATION VALUES('T4579270','038','CANCELLED','J',DATE'2022-04-02');
INSERT INTO ITINERARY_RESERVATION VALUES('D5621386','820','CONFIRMED','W',DATE'2022-03-07');
INSERT INTO ITINERARY_RESERVATION VALUES('Z7859089','499','CANCELLED','Y',DATE'2022-02-10');
CREATE TABLE PAYMENT
(
PAYMENT_ID VARCHAR2(10) NOT NULL,
RESERVATION_ID VARCHAR2(10) NOT NULL,
FIRST_NAME VARCHAR2(20) NOT NULL,
LAST_NAME VARCHAR2(20) NOT NULL,
PAYMENT_STATUS_CODE VARCHAR2(10) NOT NULL,
PAYMENT_DATE DATE NOT NULL,
CONSTRAINT PK_PAYMENT_ID PRIMARY KEY(PAYMENT_ID) ENABLE,
CONSTRAINT FK_RESERVATION_ID FOREIGN KEY (RESERVATION_ID) REFERENCES ITINERARY_RESERVATION(RESERVATION_ID)
);
INSERT INTO PAYMENT VALUES(145697734,'J8712469','SHASHANK','JAIN','APPROVED', DATE'2022-02-10');
INSERT INTO PAYMENT VALUES(457697544,'K9728499','KUNWAR', 'CHOPRA','DENIED' , DATE'2021-12-31' ) ;
INSERT INTO PAYMENT VALUES(356376426,'H3457215','DIVYA', 'SHINDE','APPROVED', DATE'2021-12-24' ) ;
INSERT INTO PAYMENT VALUES(627964697,'O6582930','ADITYA', 'SARGAR','DENIED', DATE'2022-01-25' ) ;
INSERT INTO PAYMENT VALUES(627964656,'A1634528','Niul', 'Koshti', 'APPROVED', DATE'2022-03-02') ;
INSERT INTO PAYMENT VALUES(807688769,'L0849372','Saurabh', 'Tripathi','APPROVED',DATE'2022-02-19');
INSERT INTO PAYMENT VALUES(086254646,'C8739275','Apurva', 'Shewale', 'DENIED',DATE'2022-03-15' ) ;
--INSERT INTO PAYMENT VALUES(976759724,'W3596072','Tejas', 'Bawankar','DENIED' , DATE'2022-04-15' ) ;
INSERT INTO PAYMENT VALUES(646278680,'X5638952','Etha', 'Salunke', 'APPROVED', DATE'2022-04-07') ;
INSERT INTO PAYMENT VALUES(462146477,'F4452398','Anjali', 'Patkar', 'APPROVED', DATE'2022-02-25') ;
INSERT INTO PAYMENT VALUES(976567354,'B3462597','Shreya', 'Subedi', 'DENIED', DATE'2022-02-10') ;
INSERT INTO PAYMENT VALUES(643143776,'R5684329','Sheetal', 'Kumar', 'APPROVED', DATE'2022-01-18') ;
INSERT INTO PAYMENT VALUES(753245757,'T4579270','Siddhart', 'Sawant','DENIED', DATE'2022-02-23' ) ;
INSERT INTO PAYMENT VALUES(725725455,'D5621386','HERIKA', 'HARESH', 'APPROVED', DATE'2022-03-05' );
INSERT INTO PAYMENT VALUES(834574533,'Z7859089','GAURI', 'PASARKAR','DENIED' , DATE'2022-03-11' ) ;
CREATE TABLE AIRPORTS
( AIRPORT_CODE VARCHAR2(10) NOT NULL,
AIRPORT_NAME VARCHAR2(40) NOT NULL,
AIRPORT_CITY VARCHAR2(30) NOT NULL,
AIRPORT_STATE VARCHAR2(30) NOT NULL,
CONSTRAINT PK_AIRPORTS PRIMARY KEY (AIRPORT_CODE)
);
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('JFK','John F. Kennedy International AIRPORT','NEW YORK CITY','NEW YORK');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('TPA','TAMPA International AIRPORT','TAMPA','FLORIDA');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('LAX','Los Angeles International AIRPORT','Los Angeles','CALIFORNIA');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('ORD','Hare International Airport AIRPORT','ILLINOIS','CHICAGO');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('BOS','Logan International AIRPORT','BOSTON','MASSACHUSETTS');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('DET','DETROIT METRO AIRPORT','DETROIT','MICHIGAN');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('JAC','JACKSON HOLE AIRPORT','JACKSON','WYOMING');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('LNK','LINCOLN AIRPORT','LINCOLN','NEBRASKA');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('EWR','NEWARK INTERNATIONAL AIRPORT','NEWARK','NEW JERSEY');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('LGA','LA GUARDIA AIRPORT','QUEENS','NEW YORK');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('IAH','GEORGE BUSH INTERCONTINENTAL AIRPORT','HOUSTON','TEXAS');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('SLC','SALT LAKE CITY INTERNATIONAL AIRPORT','SALT LAKE CITY','UTAH');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('SEA','TACOMA INTERNATIONAL AIRPORT','SEATTLE','WASHINGTON');
INSERT INTO AIRPORTS (AIRPORT_CODE, AIRPORT_NAME, AIRPORT_CITY, AIRPORT_STATE) VALUES ('MKE','MILWAUKEE INTERNATIONAL AIRPORT','MILWAUKEE','WISCONSIN');
CREATE TABLE FLIGHT_SEGMENT
(
FLIGHT_NUMBER VARCHAR2(10) NOT NULL,
AIRPORT_CODE VARCHAR2(10) NOT NULL,
AIRLINE_NAME VARCHAR2(20) NOT NULL,
ORIGIN_AIRPORT_CODE VARCHAR2(10) NOT NULL,
DESTINATION_AIRPORT_CODE VARCHAR2(10) NOT NULL,
DEPARTURE_DATE_TIME TIMESTAMP,
ARRIVAL_DATE_TIME TIMESTAMP,
CONSTRAINT PK_FLIGHT_NUMBER PRIMARY KEY (FLIGHT_NUMBER),
CONSTRAINT FK_AIRPORT_CODE FOREIGN KEY (AIRPORT_CODE) REFERENCES AIRPORTS (AIRPORT_CODE)
);
INSERT INTO FLIGHT_SEGMENT VALUES('QA11032','JFK','QATAR','JFK8','MKE6','31-AUG-22 5:25:34 PM','31-AUG-22 8:45:24 PM' );
INSERT INTO FLIGHT_SEGMENT VALUES('QA21091','TPA','QATAR','TPA9','SEA5', '15-DEC-22 2:00:04 PM','15-DEC-22 3:15:10 PM');
INSERT INTO FLIGHT_SEGMENT VALUES('QA33783','LAX','QATAR','LAX6','SLC4','04-APR-22 1:15:00 PM','04-APR-22 2:25:00 PM');
INSERT INTO FLIGHT_SEGMENT VALUES('DA45634','ORD','DELTA AIRLINES','ORD7','IAH1','03-MAR-22 10:25:00 AM','03-MAR-22 12:25:00 PM');
INSERT INTO FLIGHT_SEGMENT VALUES('DA66485','BOS','DELTA AIRLINES','DET4','TOL2','12-MAY-22 7:30:00 PM','12-MAY-22 11:28:40 PM');
INSERT INTO FLIGHT_SEGMENT VALUES('DA74562','DET','DELTA AIRLINES','BOS7','LGA3','18-AUG-22 5:25:34 AM','18-AUG-22 4:25:00 PM');
INSERT INTO FLIGHT_SEGMENT VALUES('AA45768','JAC','AMERICAN AIRLINES','JAC4','EWR4','29-OCT-22 11:25:34 PM','29-OCT-22 4:00:00 AM');
INSERT INTO FLIGHT_SEGMENT VALUES('AA12342','LNK','AMERICAN AIRLINES','LNK3','LGA2','01-APR-22 7:25:30 PM','01-APR-22 12:25:30 PM');
INSERT INTO FLIGHT_SEGMENT VALUES('AA55567','EWR','AMERICAN AIRLINES','EWR4','JAC4','31-AUG-22 9:00:30 AM','31-AUG-22 8:15:00 PM');
INSERT INTO FLIGHT_SEGMENT VALUES('TA77865','LGA','TURKISH AIRLINES','LGA3','BOS7','09-MAY-22 1:15:00 PM','09-MAY-22 3:45:00 PM');
--INSERT INTO FLIGHT_SEGMENT VALUES('TA45231','TOL','TURKISH AIRLINES','TOL2','DET4','25-JULY-22 6:30:00 AM','25-JULY-22 5:00:00 AM');
INSERT INTO FLIGHT_SEGMENT VALUES('TA69642','IAH','TURKISH AIRLINES','IAH1','ORD7','19-MAY-22 7:30:00 AM','19-MAY-22 9:25:00 AM');
INSERT INTO FLIGHT_SEGMENT VALUES('WA23231','SLC','WESTERN AIRLINES','SLC4','LAX6','22-JUNE-22 3:45:00 PM','22-JUNE-22 5:25:34 PM');
INSERT INTO FLIGHT_SEGMENT VALUES('WA68533','SEA','WESTERN AIRLINES','SEA5','TPA9','07-JULY-22 01:30:00 PM','07-JULY-22 5:25:00 PM');
INSERT INTO FLIGHT_SEGMENT VALUES('WA67801','MKE','WESTERN AIRLINES','MKE6','JFK8','30-JUNE-22 11:00:34 PM','30-JUNE-22 12:30:00 AM');
CREATE TABLE LEGS
( LEG_ID VARCHAR2(10) NOT NULL,
FLIGHT_NUMBER VARCHAR2(20) NOT NULL,
ORIGIN_AIRPORT_CODE VARCHAR2(10) NOT NULL,
DESTINATION_AIRPORT_CODE VARCHAR2(10) NOT NULL,
DEPARTURE_DATE_TIME TIMESTAMP NOT NULL,
ARRIVAL_DATE_TIME TIMESTAMP NOT NULL,
CONSTRAINT PK_LEGS PRIMARY KEY (LEG_ID),
CONSTRAINT FK_FLIGHT_NUMBER FOREIGN KEY (FLIGHT_NUMBER) REFERENCES FLIGHT_SEGMENT(FLIGHT_NUMBER)
);
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('JFK-MKE','QA11032','JFK8','MKE6','31-AUG-22 5:25:34 PM','31-AUG-22 8:45:24 PM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('TPA-SEA','QA21091','TPA9','SEA5','15-DEC-22 2:00:04 PM','15-DEC-22 3:15:10 PM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('LAX-SLC','QA33783','LAX6','SLC4','04-APR-22 1:15:00 PM','04-APR-22 2:25:00 PM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('ORD-IAH','DA45634','ORD7','IAH1','03-MAR-22 10:25:00 AM','03-MAR-22 12:25:00 PM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('DET-TOL','DA66485','DET4','TOL2','12-MAY-22 7:30:00 PM','12-MAY-22 11:28:40 PM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('BOS-LGA','DA74562','BOS7','LGA3','18-AUG-22 5:25:34 AM','18-AUG-22 4:25:00 PM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('JAC-EWR','AA45768','JAC4','EWR4','29-OCT-22 11:25:34 PM','29-OCT-22 4:00:00 AM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('LNK-LGA','AA12342','LNK3','LGA2','01-APR-22 7:25:30 PM','01-APR-22 12:25:30 PM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('EWR-JAC','AA55567','EWR4','JAC4','31-AUG-22 9:00:30 AM','31-AUG-22 8:15:00 PM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('LGA-BOS','TA77865','LGA3','BOS7','09-MAY-22 1:15:00 PM','09-MAY-22 3:45:00 PM');
--INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('TOL-DET','TA45231','TOL2','DET4','25-JULY-22 6:30:00 AM','25-JULY-22 5:00:00 AM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('IAH-ORD','TA69642','IAH1','ORD7','19-MAY-22 7:30:00 AM','19-MAY-22 9:25:00 AM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('SLC-LAX','WA23231','SLC4','LAX6','22-JUNE-22 3:45:00 PM','22-JUNE-22 5:25:34 PM');
INSERT INTO LEGS (LEG_ID, FLIGHT_NUMBER, ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, DEPARTURE_DATE_TIME, ARRIVAL_DATE_TIME) VALUES ('SEA-TPA','WA68533','SEA5','TPA9','07-JULY-22 01:30:00 PM','07-JULY-22 5:25:00 PM');
CREATE TABLE ITINERARY_LEGS (
RESERVATION_ID VARCHAR2(10) NOT NULL,
LEG_ID VARCHAR2(10) NOT NULL,
CONSTRAINT PK_ITINERARY_LEGS PRIMARY KEY (RESERVATION_ID),
CONSTRAINT FK_LEG_ID FOREIGN KEY (LEG_ID)REFERENCES LEGS(LEG_ID)
);
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('J8712469','JFK-MKE');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('K9728499','TPA-SEA');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('H3457215','LAX-SLC');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('O6582930','ORD-IAH');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('A1634528','DET-TOL');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('L0849372','BOS-LGA');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('C8739275','JAC-EWR');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('W3596072','LNK-LGA');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('X5638952','EWR-JAC');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('F4452398','LGA-BOS');
--INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('B3462597','TOL-DET');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('R5684329','IAH-ORD');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('T4579270','SLC-LAX');
INSERT INTO ITINERARY_LEGS (RESERVATION_ID, LEG_ID) VALUES ('D5621386','SEA-TPA');
CREATE TABLE FLIGHT_STATUS(
FLIGHT_NUMBER VARCHAR2(10) NOT NULL ,
STATUS VARCHAR2(20) NOT NULL
);
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('QA11032','IN TRANSIST');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('QA21091','DELAYED');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('QA33783','ARRIVED');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('DA45634','DEPARTED');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('DA66485','IN TRANSIST');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('DA74562','IN TRANSIST');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('AA45768','ARRIVED');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('AA12342','DEPARTED');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('AA55567','IN TRANSIST');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('TA77865','DELAYED');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('TA45231','DELAYED');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('TA69642','IN TRANSIST');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('WA23231','DEPARTED');
INSERT INTO FLIGHT_STATUS(FLIGHT_NUMBER,STATUS) VALUES ('WA68533','ARRIVED');
CREATE TABLE FLIGHT_COST(
FLIGHT_NUMBER VARCHAR2(10) NOT NULL,
ORIGIN_AIRPORT_CODE VARCHAR2(10) NOT NULL,
DESTINATION_AIRPORT_CODE VARCHAR2(10) NOT NULL,
COST_PRICE NUMBER NOT NULL,
SELLING_PRICE NUMBER NULL,
TOTAL_SEATS NUMBER NULL,
AVAILABLE_SEATS NUMBER NOT NULL,
CONSTRAINT FK_FLIGHT_COST FOREIGN KEY (FLIGHT_NUMBER) REFERENCES FLIGHT_SEGMENT(FLIGHT_NUMBER)
);
INSERT INTO FLIGHT_COST VALUES ('QA11032','JFK8','MKE6',100,120,90,70);
INSERT INTO FLIGHT_COST VALUES ('QA21091','TPA9','SEA5',120,144,90,62);
INSERT INTO FLIGHT_COST VALUES ('QA33783','LAX6','SLC4',130,156,90,30);
INSERT INTO FLIGHT_COST VALUES ('DA45634','ORD7','IAH1',140,168,90,45);
INSERT INTO FLIGHT_COST VALUES ('DA66485','DET4','TOL2',90,108,90,66);
INSERT INTO FLIGHT_COST VALUES ('DA74562','BOS7','LGA3',100,120,90,55);
INSERT INTO FLIGHT_COST VALUES ('AA45768','JAC4','EWR4',140,168,90,36);
INSERT INTO FLIGHT_COST VALUES ('AA12342','LNK3','LGA2',200,240,90,12);
INSERT INTO FLIGHT_COST VALUES ('AA55567','EWR4','JAC4',240,288,90,08);
INSERT INTO FLIGHT_COST VALUES ('TA77865','LGA3','BOS7',210,252,90,15);
--INSERT INTO FLIGHT_COST VALUES ('TA45231','TOL2','DET4',150,180,90,25);
INSERT INTO FLIGHT_COST VALUES ('TA69642','IAH1','ORD7',60,72,90,72);
INSERT INTO FLIGHT_COST VALUES ('WA23231','SLC4','LAX6',50,60,90,69);
INSERT INTO FLIGHT_COST VALUES ('WA68533','SEA5','TPA9',110,132,90,58);
INSERT INTO FLIGHT_COST VALUES ('WA67801','MKE6','JFK8',100,120,90,60);
CREATE TABLE REFERENCE_CALENDER
(
DAY_DATE DATE NOT NULL,
DAY_NUMBER NUMBER(10) NOT NULL,
BUSINESS_DAY VARCHAR2(10) NOT NULL,
CONSTRAINT PK_REFERENCE_CALENDER PRIMARY KEY (DAY_DATE)
);
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('18-APR-2022','1','MONDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('17-MAR-2022','7','SUNDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('18-AUG-2022','1','MONDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('04-FEB-2022','1','MONDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('14-JUNE-2022','4','THURSDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('16-JULY-2022','3','WEDNESDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('14-MAR-2022','4','THURSDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('21-MAY-2022','1','MONDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('18-JAN-2022','1','MONDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('08-AUG-2022','2','TUESDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('14-OCT-2022','1','MONDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('16-NOV-2022','3','WEDNESDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('08-DEC-2022','2','TUESDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('26-OCT-2022','6','SATURDAY');
INSERT INTO REFERENCE_CALENDER(DAY_DATE,DAY_NUMBER,BUSINESS_DAY) VALUES ('25-NOV-2022','5','FRIDAY');

-------------------- REPORT Views --------------------------------------------------------------------------

---View for fare curve---

CREATE VIEW FARE_CURVE AS
SELECT  fseg.airline_name, fc.available_seats, fc.SELLING_PRICE
FROM FLIGHT_COST fc
inner join flight_segment fseg
on fc.flight_number = fseg.flight_number
and AVAILABLE_SEATS >50;


---View for flight status---
CREATE VIEW FLIGHT_STATUS AS
SELECT S.STATUS, COUNT(*)
FROM FLIGHT_SEGMENT SEG
INNER JOIN FLIGHT_STATUS S ON SEG.FLIGHT_NUMBER = S.FLIGHT_NUMBER
INNER JOIN AIRPORTS A ON SEG.AIRPORT_CODE = A.AIRPORT_CODE
AND S.STATUS in ('IN TRANSIST', 'DEPARTED', 'ARRIVED')
GROUP BY S.STATUS;

---View for Member type---
CREATE VIEW MEMBER_TYPE AS 
SELECT m.member_type, count(Member_type) member_type, M.FREE_MILES
FROM PASSENGERS P
INNER JOIN MEMBERSHIP M ON P.PHONE_NUMBER = M.PHONE_NUMBER
AND MEMBER_TYPE IN ('SILVER', 'GOLD', 'PLATINUM')
group by M.FREE_MILES, m.member_type;


---View for Membership information---
CREATE VIEW MEMBERSHIP_INFORMATION AS
SELECT IR.TRAVEL_CLASS_CODE, count(*)
FROM PASSENGERS P
INNER JOIN ITINERARY_RESERVATION IR
ON IR.PASSENGER_ID = P.PASSENGER_ID
group by IR.TRAVEL_CLASS_CODE; 


--------- VIEW --------------

DROP VIEW BOARDING_PASS;

CREATE VIEW BOARDING_PASS
AS
SELECT FIRST_NAME, LAST_NAME, PAYMENT_STATUS_CODE, RESERVATION_ID, PAYMENT_DATE
FROM PAYMENT;
SELECT * FROM BOARDING_PASS;


DROP VIEW TRAVELCLASS;
CREATE VIEW TRAVELCLASS
AS
SELECT P.PASSENGER_ID, P.FIRST_NAME, P.LAST_NAME, IR.TRAVEL_CLASS_CODE
FROM PASSENGERS P
INNER JOIN ITINERARY_RESERVATION IR
ON IR.PASSENGER_ID = P.PASSENGER_ID
;
SELECT * FROM TRAVELCLASS;

DROP VIEW FLIGHT_CURRENT_STATUS;
CREATE VIEW FLIGHT_CURRENT_STATUS
AS
SELECT SEG.FLIGHT_NUMBER, SEG.AIRLINE_NAME, A.AIRPORT_NAME, SEG.DEPARTURE_DATE_TIME, S.STATUS, SEG.AIRPORT_CODE
FROM FLIGHT_SEGMENT SEG
INNER JOIN FLIGHT_STATUS S ON SEG.FLIGHT_NUMBER = S.FLIGHT_NUMBER
INNER JOIN AIRPORTS A ON SEG.AIRPORT_CODE = A.AIRPORT_CODE;
SELECT * FROM FLIGHT_CURRENT_STATUS;

DROP VIEW MEMBERSHIP_TYPE;
CREATE VIEW MEMBERSHIP_TYPE
AS
SELECT P.FIRST_NAME, P.LAST_NAME, M.MEMBER_TYPE, M.FREE_MILES
FROM PASSENGERS P
INNER JOIN MEMBERSHIP M ON P.PHONE_NUMBER = M.PHONE_NUMBER
AND MEMBER_TYPE IN ('SILVER', 'GOLD', 'PLATINUM');
SELECT * FROM MEMBERSHIP_TYPE;

DROP VIEW FARE_PRICE;
CREATE VIEW FARE_PRICE
AS
SELECT ORIGIN_AIRPORT_CODE, DESTINATION_AIRPORT_CODE, AVAILABLE_SEATS, SELLING_PRICE
FROM FLIGHT_COST;
SELECT * FROM FARE_PRICE;

DROP VIEW PASSENGERS_DETAILS;
CREATE VIEW PASSENGERS_DETAILS
AS
SELECT FIRST_NAME, LAST_NAME, EMAIL_ID, PHONE_NUMBER, CITY, STATE, COUNTRY
FROM PASSENGERS;
SELECT * FROM PASSENGERS_DETAILS;

---------------------------------------------------------------------------------------------------------------


-- Stored Procedure for flight details by status --


CREATE OR REPLACE PROCEDURE FLIGHTSBYSTATUS
(
IN_STATUS IN VARCHAR2
) AS
CURSOR STATUSOFFLIGHT is
select distinct f.FLIGHT_number ,f.AIRLINE_NAME ,f.ARRIVAL_DATE_TIME,f.departure_DATE_TIME,f.ORIGIN_AIRPORT_CODE,f.DESTINATION_AIRPORT_CODE,fs.STATUS from flight_segment f, flight_status fs
where F.FLIGHT_number=FS.FLIGHT_number
and fs.STATUS =IN_STATUS;
FlightStatus STATUSOFFLIGHT%rowtype;
BEGIN
Open STATUSOFFLIGHT ;
LOOP
fetch STATUSOFFLIGHT into FlightStatus;
EXIT WHEN STATUSOFFLIGHT%NOTFOUND;
dbms_output.put_line (FlightStatus.FLIGHT_NUMBER || ' ' || FlightStatus.AIRLINE_NAME || ' ' || FlightStatus.ARRIVAL_DATE_TIME || ' ' || FlightStatus.departure_DATE_TIME|| ' ' ||FlightStatus.ORIGIN_AIRPORT_CODE || ' ' || FlightStatus.DESTINATION_AIRPORT_CODE || ' ' || FlightStatus.STATUS);
END LOOP;
close STATUSOFFLIGHT;
END FLIGHTSBYSTATUS;

--- Testing in sql developer ---
SET SERVEROUTPUT ON
exec FLIGHTSBYSTATUS('DELAYED');
-- OR --
SET SERVEROUTPUT ON
exec FLIGHTSBYSTATUS('IN TRANSIST');
-- OR --
SET SERVEROUTPUT ON
exec FLIGHTSBYSTATUS('ARRIVED');
-- OR --
SET SERVEROUTPUT ON
exec FLIGHTSBYSTATUS('DEPARTED');




---------------------------------------------------------------------------------------------------




CREATE OR REPLACE PROCEDURE MEMBERSHIPCOUNT
(
IN_MEMBER_TYPE IN VARCHAR2
) AS
CURSOR MEMBERSHIPDETAILS is
select fs.AIRLINE_NAME,fS.FLIGHT_NUMBER,IR.PASSENGER_ID,p.FIRST_NAME,p.LAST_NAME,p.EMAIL_ID,P.PHONE_NUMBER,M.MEMBER_TYPE,FS.DEPARTURE_DATE_TIME from LEGS L, ITINERARY_LEGS IL, ITINERARY_RESERVATION IR, FLIGHT_SEGMENT fS,PASSENGERS p, MEMBERSHIP M, LOGIN_SIGNUP LS
where LS.PHONE_NUMBER=M.PHONE_NUMBER
AND LS.PHONE_NUMBER=P.PHONE_NUMBER
AND IR.PASSENGER_ID=P.PASSENGER_ID
AND IR.RESERVATION_ID=IL.RESERVATION_ID
AND IL.LEG_ID = L.LEG_ID
AND FS.FLIGHT_NUMBER = L.FLIGHT_NUMBER
AND m.member_type=IN_MEMBER_TYPE;
PASSDETAILS MEMBERSHIPDETAILS%rowtype;
BEGIN
Open MEMBERSHIPDETAILS ;
LOOP
fetch MEMBERSHIPDETAILS into PASSDETAILS;
EXIT WHEN MEMBERSHIPDETAILS%NOTFOUND;
dbms_output.put_line (PASSDETAILS.AIRLINE_NAME || ' ' || PASSDETAILS.FLIGHT_NUMBER || ' ' || PASSDETAILS.PASSENGER_ID || ' ' || PASSDETAILS.FIRST_NAME|| ' ' ||PASSDETAILS.LAST_NAME || ' ' || PASSDETAILS.EMAIL_ID || ' ' || PASSDETAILS.PHONE_NUMBER || ' ' || PASSDETAILS.MEMBER_TYPE || ' ' || PASSDETAILS.DEPARTURE_DATE_TIME);
END LOOP;
close MEMBERSHIPDETAILS;
END MEMBERSHIPCOUNT;
--Testing in sql developer: Oracle db--


SET SERVEROUTPUT ON
exec MEMBERSHIPCOUNT('PLATINUM');
SET SERVEROUTPUT ON
exec MEMBERSHIPCOUNT('SILVER');
SET SERVEROUTPUT ON
exec MEMBERSHIPCOUNT('GOLD');


-------------------------------------------------------------------------------------------------

CREATE OR REPLACE TRIGGER DELAYEDFLIGHTS
AFTER INSERT ON FLIGHT_STATUS
FOR EACH ROW
DECLARE
BEGIN
if updating('STATUS')
then
insert into flight_status (FLIGHT_NUMBER, STATUS) values(:new.FLIGHT_NUMBER,:new.STATUS);
end if;
END;
-- This is audit table for this trigger--
CREATE TABLE "DELAYED_FLIGHT"
( "FLIGHT_NUMBER" VARCHAR2(20 BYTE),
"STATUS" VARCHAR2(20 BYTE)
);
----- TRIGGER TO UPDATE 'TICKET_PRICE_HISTORY' TABLE WHEN THE PRICE OF AN AIR TICKET IS UPDATED IN FLIGHT_COST TABLE ----
-- CREATING TABLE TICKET_PRICE_HISTORY --
CREATE TABLE TICKET_PRICE_HISTORY
(
FLIGHT_NUMBER VARCHAR2(10) NOT NULL,
ORIGIN_AIRPORT_CODE VARCHAR2(10) NOT NULL,
DESTINATION_AIRPORT_CODE VARCHAR2(10) NOT NULL,
COST_PRICE NUMBER NOT NULL,
SELLING_PRICE NUMBER NULL,
TOTAL_SEATS NUMBER NULL,
AVAILABLE_SEATS NUMBER NOT NULL,
CONSTRAINT FK_TICKET_PRICE_HISTORY FOREIGN KEY (FLIGHT_NUMBER) REFERENCES FLIGHT_SEGMENT(FLIGHT_NUMBER)
);
-- CREATE A TRIGGER TICKET_PRICE_HISTORY --
CREATE OR REPLACE TRIGGER TICKET_PRICE_HISTORY
BEFORE UPDATE OF SELLING_PRICE
ON FLIGHT_COST
FOR EACH ROW
BEGIN
INSERT INTO TICKET_PRICE_HISTORY
VALUES(:OLD.FLIGHT_NUMBER, :OLD.ORIGIN_AIRPORT_CODE, :OLD.DESTINATION_AIRPORT_CODE, :OLD.COST_PRICE, :OLD.SELLING_PRICE, :OLD.TOTAL_SEATS, :OLD.AVAILABLE_SEATS);
END;
SELECT * FROM TICKET_PRICE_HISTORY;
--LET'S UPDATE A PRICE OR FARE OF AN AIR TICKET --
UPDATE FLIGHT_COST
SET SELLING_PRICE=80
WHERE FLIGHT_NUMBER ='WA23231'
AND ORIGIN_AIRPORT_CODE='SLC4'
AND DESTINATION_AIRPORT_CODE='LAX6'
AND AVAILABLE_SEATS=69
SELECT * FROM FLIGHT_COST
WHERE FLIGHT_NUMBER ='WA23231'
AND ORIGIN_AIRPORT_CODE='SLC4'
AND DESTINATION_AIRPORT_CODE='LAX6'
AND AVAILABLE_SEATS=69;



-----------------------------------------------------------------------------------------------------------------------------------------------------------------

--------------- CREATE PROFILE MANAGEMENT FOR MANAGEMENT USERS ---------------------
DROP PROFILE AIRLINES_MANAGEMENT CASCADE;
CREATE PROFILE AIRLINES_MANAGEMENT LIMIT
SESSIONS_PER_USER UNLIMITED
CPU_PER_SESSION UNLIMITED
CONNECT_TIME 15
FAILED_LOGIN_ATTEMPTS 5
PASSWORD_LIFE_TIME 90;

---------------- CREATE AIRLINE REPRESENTATIVE USER WHO GIVES BOARDING PASS -------------------------
DROP USER AIRLINE_REPRESENTATIVE;
CREATE USER AIRLINE_REPRESENTATIVE
IDENTIFIED BY Northeastern2022
PROFILE AIRLINES_MANAGEMENT
ACCOUNT UNLOCK;
GRANT CONNECT TO AIRLINE_REPRESENTATIVE;
GRANT CREATE SESSION TO AIRLINE_REPRESENTATIVE;
GRANT UNLIMITED TABLESPACE TO AIRLINE_REPRESENTATIVE;

------------------ CREATE ROLE READ TICKET DETAILS ---------------

CREATE ROLE READ_TICKET_DETAILS;
----------------- GRANT ACCESS TO ROLE --------------------------
GRANT SELECT ON BOARDING_PASS TO READ_TICKET_DETAILS;
GRANT SELECT ON TRAVELCLASS TO READ_TICKET_DETAILS;
GRANT SELECT ON MEMBERSHIP_INFORMATION TO READ_TICKET_DETAILS;
GRANT SELECT ON PASSENGERS_DETAILS TO READ_TICKET_DETAILS;
------------------- GRANT ROLE TO USERS ---------------------------
GRANT READ_TICKET_DETAILS TO AIRLINE_REPRESENTATIVE;
------------------- RUN SCRIPT FROM USER ACCOUNT BY LOGGING USING ABOVE MENTIONED PASSWORD AND USERNAME, WHERE USER HAS ACCESS TO VIEWS WHICH ARE GRANTED BY DBADMIN -----------
/* SELECT * FROM ADMIN.BOARDING_PASS;
SELECT * FROM ADMIN.TRAVELCLASS;
SELECT * FROM ADMIN.MEMBERSHIP_INFORMATION;
SELECT * FROM ADMIN.PASSENGERS_DETAILS; */
-------------------------------- CREATE CUSTOMER PROFILE --------------------------
DROP PROFILE CUSTOMER CASCADE;
CREATE PROFILE CUSTOMER LIMIT
SESSIONS_PER_USER UNLIMITED
CPU_PER_SESSION UNLIMITED
CONNECT_TIME 15
FAILED_LOGIN_ATTEMPTS 5
PASSWORD_LIFE_TIME 90;
-------------------- CREATE CUSTOMER USER TO CHECK FLIGHT STATUS AND PERSONAL INFORMATION -------------
DROP USER CUSTOMER1;
CREATE USER CUSTOMER1
IDENTIFIED BY Northeastern2022
PROFILE CUSTOMER
ACCOUNT UNLOCK;
GRANT CONNECT TO CUSTOMER1;
GRANT CREATE SESSION TO CUSTOMER1;
GRANT UNLIMITED TABLESPACE TO CUSTOMER1;
------------------ CREATE READ ROLE TO VIEW TICKET INFOMATION ---------------
DROP ROLE READ_CUSTOMER_INFO;
CREATE ROLE READ_CUSTOMER_INFO;
------------ GRANT ACCESS TO ROLE --------------------------
GRANT SELECT ON FARE_PRICE TO READ_CUSTOMER_INFO;
GRANT SELECT ON FLIGHT_CURRENT_STATUS TO READ_CUSTOMER_INFO;
GRANT SELECT ON PASSENGERS_DETAILS TO READ_CUSTOMER_INFO;
------------------- GRANT ROLE TO CUSTOMER1 USERS ---------------------------
GRANT READ_CUSTOMER_INFO TO CUSTOMER1;
------------------- CREATE UPDATE ROLE FOR MAKING CHANGES IN PASSENGERS BIO -------------------------------
DROP ROLE DML_CUSTOMER_INFO;
CREATE ROLE DML_CUSTOMER_INFO;
------------ GRANT ACCESS TO ROLE --------------------------
GRANT SELECT, UPDATE ON PASSENGERS TO DML_CUSTOMER_INFO;
------------------- GRANT ROLE TO CUSTOMER1 USERS ---------------------------
GRANT DML_CUSTOMER_INFO TO CUSTOMER1;
------------------- RUN SCRIPT FROM USER ACCOUNT BY LOGGING USING ABOVE MENTIONED PASSWORD AND USERNAME, WHERE CUSTOMER HAS ACCESS TO VIEWS AND TABLES WHICH ARE GRANTED BY DBADMIN -----------
/*
SELECT * FROM ADMIN.FARE_PRICE;
SELECT * FROM ADMIN.FLIGHT_CURRENT_STATUS;
SELECT * FROM ADMIN.PASSENGERS_DETAILS;
SELECT * FROM ADMIN.PASSENGERS; */

------------------------------------------------------------------------------------------------------------------------------------